<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Subodh_AI</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg: #f7f5f0;
  --sidebar: #eeeae3;
  --surface: #ffffff;
  --border: #ddd8ce;
  --accent: #2d6a4f;
  --accent-h: #245a41;
  --accent-light: #e8f5e9;
  --t1: #1a1a1a;
  --t2: #6b6560;
  --t3: #9b948d;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);height:100vh;display:flex;overflow:hidden;}

/* SIDEBAR */
#sidebar{width:255px;background:var(--sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:18px 12px;gap:5px;flex-shrink:0;transition:transform .3s;}
.logo{font-family:'Playfair Display',serif;font-size:21px;color:var(--accent);padding:6px 8px 14px;border-bottom:1px solid var(--border);margin-bottom:6px;}
.logo span{color:var(--t3);font-family:'DM Sans',sans-serif;font-weight:400;font-size:18px;}
#new-btn{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-family:inherit;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:4px;transition:background .2s;}
#new-btn:hover{background:var(--accent-h);}
.sec-title{font-size:11px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.8px;padding:8px 8px 3px;}
.hist-item{padding:8px 10px;border-radius:9px;font-size:13px;color:var(--t2);cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:background .15s,color .15s;}
.hist-item:hover,.hist-item.active{background:var(--surface);color:var(--t1);}
.sidebar-bottom{margin-top:auto;border-top:1px solid var(--border);padding-top:12px;}
.user-row{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:9px;cursor:pointer;}
.user-row:hover{background:var(--surface);}
.av{width:32px;height:32px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px;flex-shrink:0;}

/* MAIN */
#main{flex:1;display:flex;flex-direction:column;min-width:0;}
#topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:12px 22px;display:flex;align-items:center;gap:10px;}
#menu-btn{display:none;background:none;border:none;cursor:pointer;padding:4px;}
.model-badge{background:var(--accent-light);border:1px solid #c8e6c9;border-radius:8px;padding:5px 14px;font-size:13.5px;font-weight:500;color:var(--accent);}
.status-dot{width:8px;height:8px;border-radius:50%;background:#4caf50;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}

/* CHAT */
#chat{flex:1;overflow-y:auto;padding:28px 0;}
#chat::-webkit-scrollbar{width:5px;}
#chat::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}

/* WELCOME */
#welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:40px 20px;animation:fadeUp .5s ease;}
.w-icon{width:62px;height:62px;border-radius:18px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:18px;box-shadow:0 8px 24px rgba(45,106,79,.22);}
#welcome h1{font-family:'Playfair Display',serif;font-size:30px;color:var(--t1);margin-bottom:8px;}
#welcome p{color:var(--t2);font-size:15px;max-width:400px;line-height:1.65;margin-bottom:32px;}
.sugg-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:500px;width:100%;}
.sugg-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:13px 15px;cursor:pointer;text-align:left;font-size:13.5px;color:var(--t2);line-height:1.5;transition:all .2s;}
.sugg-card:hover{border-color:var(--accent);box-shadow:0 4px 14px rgba(45,106,79,.1);transform:translateY(-1px);color:var(--t1);}
.sugg-card strong{display:block;color:var(--t1);font-size:14px;margin-bottom:2px;}

/* MESSAGES */
.msg-wrap{max-width:740px;margin:0 auto;padding:0 22px 24px;animation:fadeUp .3s ease;}
.msg{display:flex;gap:13px;align-items:flex-start;}
.msg-av{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;margin-top:2px;}
.msg-av.user{background:var(--accent);color:#fff;}
.msg-av.ai{background:var(--accent-light);color:var(--accent);border:1px solid var(--border);}
.msg-name{font-size:11px;font-weight:600;color:var(--t3);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px;}
.msg-body{flex:1;line-height:1.75;font-size:15px;padding-top:4px;}
.msg-body.user-body{background:var(--accent-light);border:1px solid #c8e6c9;border-radius:0 13px 13px 13px;padding:11px 15px;}
.msg-body pre{background:#1e1e2e;color:#cdd6f4;border-radius:10px;padding:14px 16px;overflow-x:auto;margin:10px 0;font-size:13px;line-height:1.6;}
.msg-body code{background:#f0ede6;border:1px solid var(--border);border-radius:4px;padding:1px 5px;font-size:13px;font-family:monospace;}
.msg-body pre code{background:none;border:none;padding:0;color:inherit;font-size:inherit;}
.msg-actions{display:flex;gap:5px;margin-top:7px;opacity:0;transition:opacity .2s;}
.msg-wrap:hover .msg-actions{opacity:1;}
.act-btn{background:none;border:1px solid var(--border);border-radius:6px;padding:3px 10px;font-size:12px;color:var(--t3);cursor:pointer;font-family:inherit;transition:all .15s;}
.act-btn:hover{background:var(--bg);color:var(--t1);}

/* TYPING */
.typing{display:flex;gap:5px;padding:6px 2px;}
.typing span{width:7px;height:7px;border-radius:50%;background:var(--accent);opacity:.4;animation:bounce 1.2s infinite;}
.typing span:nth-child(2){animation-delay:.2s;}
.typing span:nth-child(3){animation-delay:.4s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-5px);opacity:1}}

/* INPUT */
#input-area{background:var(--surface);border-top:1px solid var(--border);padding:14px 22px 18px;}
.input-box{max-width:740px;margin:0 auto;background:var(--bg);border:1.5px solid var(--border);border-radius:14px;display:flex;align-items:flex-end;gap:8px;padding:11px 12px;transition:border-color .2s,box-shadow .2s;}
.input-box:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(45,106,79,.1);}
#user-input{flex:1;background:none;border:none;outline:none;font-family:inherit;font-size:15px;color:var(--t1);resize:none;max-height:180px;line-height:1.6;overflow-y:auto;}
#user-input::placeholder{color:#b0a99f;}
#send-btn{width:34px;height:34px;border-radius:9px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .2s,transform .1s;}
#send-btn:not(:disabled){background:var(--accent);}
#send-btn:not(:disabled):hover{background:var(--accent-h);transform:scale(1.05);}
#send-btn:disabled{background:var(--border);cursor:not-allowed;}
.hint{text-align:center;font-size:11.5px;color:var(--t3);margin-top:7px;max-width:740px;margin-left:auto;margin-right:auto;}

/* ERROR TOAST */
#toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#d32f2f;color:#fff;padding:10px 20px;border-radius:10px;font-size:14px;display:none;z-index:99;animation:fadeUp .3s ease;}

@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:640px){
  #sidebar{position:absolute;z-index:10;height:100%;transform:translateX(-100%);}
  #sidebar.open{transform:translateX(0);}
  #menu-btn{display:flex;}
}
</style>
</head>
<body>

<div id="toast"></div>

<!-- SIDEBAR -->
<aside id="sidebar">
  <div class="logo">Subodh<span>_AI</span></div>
  <button id="new-btn" onclick="newChat()">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    New chat
  </button>
  <div class="sec-title" id="hist-label" style="display:none">Recent</div>
  <div id="hist-list"></div>
  <div class="sidebar-bottom">
    <div class="user-row">
      <div class="av">S</div>
      <div>
        <div style="font-size:14px;font-weight:500">Subodh</div>
        <div style="font-size:11px;color:var(--t3)">Personal ¬∑ Free</div>
      </div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main id="main">
  <div id="topbar">
    <button id="menu-btn" onclick="toggleSidebar()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6b6560" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="model-badge">‚ú¶ Subodh-AI v1.0</div>
    <div class="status-dot" title="Online"></div>
  </div>

  <div id="chat">
    <div id="welcome">
      <div class="w-icon">‚ú¶</div>
      <h1>Hello, I'm Subodh_AI</h1>
      <p>Your personal AI assistant. Ask me anything ‚Äî I'm here to help you think, create, and explore.</p>
      <div class="sugg-grid">
        <div class="sugg-card" onclick="sendSugg('Draft a professional email to my team about a project update')">
          <strong>‚úçÔ∏è Write for me</strong>Draft a professional email to my team
        </div>
        <div class="sugg-card" onclick="sendSugg('Give me 5 creative startup ideas in fintech')">
          <strong>üí° Brainstorm</strong>Give me 5 startup ideas in fintech
        </div>
        <div class="sugg-card" onclick="sendSugg('Explain how async/await works in JavaScript with examples')">
          <strong>üßë‚Äçüíª Help me code</strong>Explain async/await in JavaScript
        </div>
        <div class="sugg-card" onclick="sendSugg('What is machine learning explained in simple terms?')">
          <strong>üìö Explain</strong>What is machine learning?
        </div>
      </div>
    </div>
  </div>

  <div id="input-area">
    <div class="input-box">
      <textarea id="user-input" placeholder="Message Subodh_AI..." rows="1"
        oninput="resize(this)" onkeydown="handleKey(event)"></textarea>
      <button id="send-btn" disabled onclick="sendMsg()">
        <svg viewBox="0 0 24 24" width="15" height="15" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </button>
    </div>
    <div class="hint">Subodh_AI can make mistakes. Verify important info.</div>
  </div>
</main>

<script>
let msgs = [];
let history = [];
let curId = null;
let busy = false;

const chatEl = document.getElementById('chat');
const inputEl = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

inputEl.addEventListener('input', () => {
  sendBtn.disabled = !inputEl.value.trim() || busy;
});

function resize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 180) + 'px';
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(); }
}

function sendSugg(text) {
  inputEl.value = text;
  resize(inputEl);
  sendMsg();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

async function sendMsg() {
  const text = inputEl.value.trim();
  if (!text || busy) return;

  // Remove welcome
  const w = document.getElementById('welcome');
  if (w) w.remove();

  msgs.push({ role: 'user', content: text });
  appendMsg('user', text);
  inputEl.value = '';
  inputEl.style.height = 'auto';
  sendBtn.disabled = true;
  busy = true;

  // Save history
  if (!curId) {
    curId = Date.now();
    history.unshift({ id: curId, title: text.slice(0, 40) + (text.length > 40 ? '‚Ä¶' : '') });
    renderHist();
  }

  const typingEl = appendTyping();

  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: msgs })
    });

    const data = await res.json();
    typingEl.remove();

    if (data.error) { showToast('‚ö†Ô∏è ' + data.error); appendMsg('ai', '‚ö†Ô∏è ' + data.error); }
    else { msgs.push({ role: 'assistant', content: data.reply }); appendMsg('ai', data.reply); }
  } catch (err) {
    typingEl.remove();
    showToast('‚ö†Ô∏è Could not connect to server.');
    appendMsg('ai', '‚ö†Ô∏è Could not connect. Make sure the server is running.');
  }

  busy = false;
  sendBtn.disabled = !inputEl.value.trim();
  inputEl.focus();
}

function appendMsg(role, text) {
  const wrap = document.createElement('div');
  wrap.className = 'msg-wrap';
  wrap.innerHTML = `
    <div class="msg">
      <div class="msg-av ${role}">${role === 'user' ? 'S' : '‚ú¶'}</div>
      <div style="flex:1">
        <div class="msg-name">${role === 'user' ? 'You' : 'Subodh_AI'}</div>
        <div class="msg-body ${role === 'user' ? 'user-body' : ''}">${formatText(text)}</div>
        <div class="msg-actions">
          <button class="act-btn" onclick="copyText(this, ${JSON.stringify(text)})">Copy</button>
          ${role === 'ai' ? '<button class="act-btn" onclick="regen()">‚Ü∫ Regenerate</button>' : ''}
        </div>
      </div>
    </div>`;
  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function appendTyping() {
  const wrap = document.createElement('div');
  wrap.className = 'msg-wrap';
  wrap.innerHTML = `<div class="msg"><div class="msg-av ai">‚ú¶</div><div><div class="msg-name">Subodh_AI</div><div class="typing"><span></span><span></span><span></span></div></div></div>`;
  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
  return wrap;
}

function formatText(text) {
  // Code blocks
  text = text.replace(/```(\w+)?\n?([\s\S]*?)```/g, (_, l, c) =>
    `<pre><code>${escHtml(c.trim())}</code></pre>`);
  // Inline code
  text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
  // Bold
  text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  // Newlines
  text = text.replace(/\n/g, '<br>');
  return text;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function copyText(btn, text) {
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = '‚úì Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
}

async function regen() {
  if (busy || msgs.length < 2) return;
  msgs.pop();
  const all = chatEl.querySelectorAll('.msg-wrap');
  all[all.length - 1].remove();
  busy = true;
  sendBtn.disabled = true;
  const typingEl = appendTyping();
  try {
    const res = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ messages: msgs }) });
    const data = await res.json();
    typingEl.remove();
    const reply = data.reply || '‚ö†Ô∏è ' + (data.error || 'Error');
    msgs.push({ role: 'assistant', content: reply });
    appendMsg('ai', reply);
  } catch { typingEl.remove(); appendMsg('ai', '‚ö†Ô∏è Regeneration failed.'); }
  busy = false;
  sendBtn.disabled = !inputEl.value.trim();
}

function newChat() {
  msgs = []; curId = null;
  chatEl.innerHTML = '';
  const w = document.createElement('div');
  w.id = 'welcome';
  w.innerHTML = `
    <div class="w-icon">‚ú¶</div>
    <h1>Hello, I'm Subodh_AI</h1>
    <p>Your personal AI assistant. Ask me anything ‚Äî I'm here to help you think, create, and explore.</p>
    <div class="sugg-grid">
      <div class="sugg-card" onclick="sendSugg('Draft a professional email to my team about a project update')"><strong>‚úçÔ∏è Write for me</strong>Draft a professional email</div>
      <div class="sugg-card" onclick="sendSugg('Give me 5 creative startup ideas in fintech')"><strong>üí° Brainstorm</strong>5 startup ideas in fintech</div>
      <div class="sugg-card" onclick="sendSugg('Explain how async/await works in JavaScript with examples')"><strong>üßë‚Äçüíª Help me code</strong>Explain async/await in JS</div>
      <div class="sugg-card" onclick="sendSugg('What is machine learning explained in simple terms?')"><strong>üìö Explain</strong>What is machine learning?</div>
    </div>`;
  chatEl.appendChild(w);
  renderHist();
  inputEl.focus();
}

function renderHist() {
  const list = document.getElementById('hist-list');
  const label = document.getElementById('hist-label');
  label.style.display = history.length ? '' : 'none';
  list.innerHTML = history.map(h =>
    `<div class="hist-item${h.id === curId ? ' active' : ''}" title="${h.title}">${h.title}</div>`
  ).join('');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';
  setTimeout(() => t.style.display = 'none', 3500);
}
</script>
</body>
</html>
